package com.green.controller;

import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.green.dto.ArticleDto;
import com.green.entity.Article;
import com.green.repository.ArticleRepository;

@Controller
public class ArticleController{
 @Autowired
 private ArticleRepository articleRepository;

 @GetMapping("/articles/WriteForm")
 public String writeForm() {
	 return "articles/write";
   //stc/main/resources/templates/article/write.mustache
 }
 // 405에러 : method="post" -> 2GetMapping
 // 에러 @GetMapping("articles/Write")
 @PostMapping("/articles/Write")
 public String write(ArticleDto articleDto) {
	 // 넘어온데이터 확인
	 System.out.println(articleDto.toString());
	Article article = articleDto.toEntity();
	// 2. 리포지터리 (인터페이스)를 사용하여 엔티티를 저장
    Article saved= articleRepository.save(article);
    System.out.println("saved"+saved);
    return "redirect:/articles/List";
    //1번 데이터 조회: PathVariable -> GET
    // java.lang. IllegalArgumentException : Name for argument of type
    // 1번 방법. @PathVariable(value="id") 추가
    // 2번 방법. sts 설정 추가
    // 프로젝트 -> properties -> java Complier->
    // -> project specific settings 체크
    @GetMapping("/articles/{id}")
    public String view(
    		@PathVariable(value="id") Long id,
    		Model model) {
    	Article articleEntity = articleRepository.findById(id).orElse(null);
    	System.out.println("1번조회 결과:" + articleEntity);
    	model.addAttribute("article",articleEntity); //조회한 결과 -> model
    	return "articles/view"; //
    }
    	@GetMapping("/articles/List")
    	public String list(Model model) {
    	List<Article> articleEntityList = articleRepository.findALL();
    	System.out.println("전체목록:"+articleEntityList);
    	model.addAttribute("articleList",articleEntityList);
    	
    	return "article/list";
    	}
 }
    
 